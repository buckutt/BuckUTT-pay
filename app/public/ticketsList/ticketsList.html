<div class="view" ng-controller="TicketsList as ticket">
    <h1 class="text-center">BuckUTT</h1>

    <div class="row row-spaced">
        <div class="panel-col transition col-xs-12 col-sm-12 col-lg-12 loginPanel">
            <div id="loginControllerWrapper" class="transition panel panel-default"
                 ng-init="template = 'login/login.html'"
                 ng-include="template">
            </div>
        </div>
    </div>
    <div class="row row-spaced" ng-repeat="event in events">
        <div class="panel-col transition col-xs-12 col-sm-12 col-lg-12">
            <span class="closedPresale" ng-if="!event.opened">Préventes fermées</span>
            <div class="transition panel panel-default">
                <div class="panel-body active">
                    <div class="icon">
                        <img height="128" width="128" alt="{{ event.name }}"
                             ng-src="static/img/upload/{{ event.picture }}">
                    </div>
                    <div class="title">
                        <h3>
                            {{ event.name }}
                            <small class="muted">{{ event.date | date:"dd/MM/yyyy 'à' HH:mm" }}</small>
                        </h3>
                        <p class="text-muted">{{ event.description }}</p>
                    </div>
                    <div class="text-center buy" ng-click="ticket.showBuyingCards($event)" ng-if="!event.isBought">
                        <i class="fa fa-shopping-cart"></i>
                    </div>
                    <a
                        class="text-center print"
                        ng-href="/api/generatePrintLink/{{ event.ticketBoughtId }}?auth={{ jwt }}"
                        ng-if="event.isBought">
                        <i class="fa fa-print"></i>
                    </a>
                </div>
                <div class="behind panel-body">
                    <div class="cross">
                        <i class="fa fa-times" ng-click="ticket.hideBuyingCards($event)"></i>
                    </div>
                    <div class="row">
                        <div class="col-xs-6 meanOfPayment text-center">
                            <i class="fa fa-shopping-cart"
                               ng-click="ticket.expendBuy($event, 'buckutt')"></i>
                            <h4 class="description">BuckUTT</h4>
                        </div>
                        <div class="col-xs-6 meanOfPayment text-center">
                            <i class="fa fa-credit-card"
                               ng-click="ticket.expendBuy($event, 'card')"></i>
                            <h4 class="description">Carte</h4>
                        </div>
                    </div>
                    <div class="row paywith buckutt">
                        <h2>Paiement par BuckUTT</h2>
                        <div ng-if="isAuth">
                            <h4>Spécifez votre date de naissance <kbd title="Permet de distinguer deux tickets en cas de deux noms identiques">?</kbd></h4>
                            <div class="input-group">
                                <input type="text" name="date" class="form-control birthdate" placeholder="Date de naissance (JJ/MM/AAAA)"
                                       ng-model="birthdate"
                                       ng-pattern="datePattern"
                                       ng-required="true">
                            </div>
                            <h4>Solde actuel : {{ sold | euro }}</h4>
                            <h4 ng-init="ticket.getPrice(event.id)">
                                Solde après achat :
                                <span ng-if="sold - prices[event.id] < 0">
                                    <span class="soldAfter {{ event.id }} text-danger">
                                        {{ sold - prices[event.id] | euro }}
                                    </span>
                                </span>
                                <span ng-if="sold - prices[event.id] >= 0">
                                    <span class="soldAfter {{ event.id }} text-success">
                                        {{ sold - prices[event.id] | euro }}
                                    </span>
                                    <br>
                                    <br>
                                    <button class="btn btn-primary btn-lg"
                                            ng-click="ticket.buyOneWithBuckutt($event, event.id, birthdate)">
                                        Prendre une place pour cet événement
                                    </button>
                                </span>
                            </h4>
                        </div>
                        <div ng-if="!isAuth">
                            <p>Vous devez être connecté pour payer avec BuckUTT.</p>
                        </div>
                    </div>
                    <div class="row paywith card">
                        <h2>Paiement par carte bleue</h2>
                        <h4>Spécifez votre e-mail <kbd title="Permet de retrouver une place perdue ainsi qu'avoir des prix d'écoles partnaire. E-Mail vérifié.">?</kbd></h4>
                        <div class="input-group">
                            <input type="email" name="mail" class="form-control mail"
                                   ng-blur="ticket.getPrice(event.id, $event)"
                                   ng-required="true">
                        </div>
                        <h4>Spécifez votre date de naissance <kbd title="Permet de distinguer deux tickets en cas de deux noms identiques">?</kbd></h4>
                        <div class="input-group">
                            <input type="text" name="date" class="form-control birthdate" placeholder="Date de naissance (JJ/MM/AAAA)"
                                   ng-model="birthdate"
                                   ng-pattern="datePattern"
                                   ng-required="true">
                        </div>
                        <h4 ng-init="ticket.getPrice(event.id)">
                            <div ng-if="prices[event.id]">
                                <p>Prix du ticket : {{ prices[event.id] | euro }}</p>
                                <button class="btn btn-primary btn-lg"
                                        ng-click="ticket.buyOneWithCard($event, event.id, birthdate)">
                                    Prendre une place pour cet événement
                                </button>
                            </div>
                            <div ng-if="!prices[event.id]">
                                <p>
                                    Cet événement ne vous est pas disponible.
                                </p>
                            </div>
                        </h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
